<!DOCTYPE html>
<html>
<head>
    <title>Scroll-triggered Animation</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            height: 7000px; /* Total scrollable height for all sections */
        }

        #animation-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        #frame {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #start-button {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: none; /* Initially hidden */
            cursor: pointer;
        }

        #video-container {
            width: 10vw;
            height: 10vh;
            position: absolute;
            top: 3000px; /* Start of video section */
            left: 50%;
            transform: translateX(-50%);
            background-color: black;
            border-radius: 100px;
            opacity: 0; /* Initially hidden */
            transition: all 1s ease-in-out;
            overflow: hidden;
            text-align: center;
        }

        #prod-container {
            width: 100vw;
            height: 100vh;
            position: absolute;
            top: 4000px; /* Start of product section */
            background-color: white;
        }

        #myVideo {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%; 
            min-height: 100%;
        }
    </style>
</head>
<body>
    <div id="animation-container">
        <img id="frame" src="" alt="Animated Frame">
    </div>
    <button id="start-button">Start Scroll Animation</button>
    <div id="video-container">
        <video src="https://api.c0x4utlmj5-philipsdo1-d1-public.model-t.cc.commerce.ondemand.com/medias/sample-1280-xl.mp4"
               autoplay style="margin: 0 auto; width: 100%; height: 100vh; object-fit: cover;">
            <source src="https://api.c0x4utlmj5-philipsdo1-d1-public.model-t.cc.commerce.ondemand.com/medias/sample-1280-xl.mp4" type="video/mp4">
            Your browser does not support HTML5 video.
        </video>
    </div>
    <div id="prod-container">
        <p>Prod container</p>
    </div>

    <script>
        const frameElement = document.getElementById('frame');
        const startButton = document.getElementById('start-button');
        const videoContainer = document.getElementById('video-container');
        const prodContainer = document.getElementById('prod-container');

        const totalFrames = 249;
        const initialAnimationFrames = 28;
        const frameRate = 1000 / 30; // 30 FPS
        const scrollAnimationDuration = 6000; // Duration for scroll animation
        let currentFrame = 0;
        let scrollAnimationEnabled = false;

        // Define scroll depths for each section
        const scrollAnimationDepth = 3000; // Scroll animation section
        const videoSectionDepth = 1000; // Video section
        const prodSectionDepth = 3000; // Product section

        function updateFrame(frameIndex) {
            frameElement.src = `/Users/dz382/Documents/GitHub/Versuni/btl-tryouts/homepage-assets/home-entrance-desktop${frameIndex.toString().padStart(3, '0')}.jpg`;
        }

        // Initial animation from frame 1 to 28
        const initialAnimationInterval = setInterval(() => {
            if (currentFrame < initialAnimationFrames) {
                updateFrame(currentFrame);
                currentFrame++;
            } else {
                clearInterval(initialAnimationInterval);
                currentFrame = initialAnimationFrames - 1;
                scrollAnimationEnabled = true;
                startButton.style.display = 'block';
            }
        }, frameRate);

        window.addEventListener('scroll', () => {
            const scrollPosition = window.pageYOffset;

            // Scroll Animation Section
            if (scrollPosition < scrollAnimationDepth && scrollAnimationEnabled) {
                const scrollFraction = scrollPosition / scrollAnimationDepth;
                const frameIndex = Math.min(
                    Math.floor(scrollFraction * totalFrames),
                    totalFrames - 1
                );
                updateFrame(frameIndex);
            }

            // Video Section
            if (scrollPosition >= scrollAnimationDepth && scrollPosition < scrollAnimationDepth + videoSectionDepth) {
                videoContainer.style.opacity = 1;
            } else {
                videoContainer.style.opacity = 0;
            }

            // Product Section Logic (if any)
            // ...
        });

        startButton.addEventListener('click', function() {
            document.body.style.height = '7000px';
            smoothScrollTo(scrollAnimationDepth, scrollAnimationDuration);
        });

        function smoothScrollTo(targetPosition, duration) {
            const startPosition = window.pageYOffset;
            const distance = targetPosition - startPosition;
            let startTime = null;

            function animation(currentTime) {
                if (startTime === null) startTime = currentTime;
                const timeElapsed = currentTime - startTime;
                const run = ease(timeElapsed, startPosition, distance, duration);
                window.scrollTo(0, run);

                if (timeElapsed < duration) requestAnimationFrame(animation);
            }

            function ease(t, b, c, d) {
                t /= d / 2;
                if (t < 1) return c / 2 * t * t + b;
                t--;
                return -c / 2 * (t * (t - 2) - 1) + b;
            }

            requestAnimationFrame(animation);
        }
    </script>
</body>
</html>
