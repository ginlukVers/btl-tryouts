<!DOCTYPE html>
<html>

<head>
    <title>Scroll-triggered Animation</title>
    <style>
    body,
    html {
        margin: 0;
        padding: 0;
        overflow-x: hidden;
        height: 10000px;
    }

    #animation-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
    }

    #frame {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    #start-button {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: none;
        /* Initially hidden */
        cursor: pointer;
    }
    #video-container {
        /* Initial styles for video-container */
        width: 10vw;
        height: 10vh;
        position: absolute;
        top: 5000px;
        left: 50%;
        transform: translateX(-50%);
        background-color: black;
        border-radius: 100px;
        opacity: 0;
        transition: all 1s ease-in-out;
        overflow: hidden;
        text-align: center;
    }
    #prod-container {
        width: 100vw;
        height: 100vh;
        position: absolute;
        top:calc(5000px + 100vh);
        background-color: white;
    }
    #myVideo {
  position: fixed;
  right: 0;
  bottom: 0;
  min-width: 100%; 
  min-height: 100%;
}
    </style>
</head>

<body>
    <div id="animation-container" style="">
        <img id="frame" src="" alt="Animated Frame">
    </div>
    <button id="start-button">Start Scroll Animation</button>
    <div id="video-container">
    <!-- <video loop="true" autoplay="autoplay" controls="controls" muted id="myVideo"> -->

        <video _ngcontent-serverapp-c263="" src="https://api.c0x4utlmj5-philipsdo1-d1-public.model-t.cc.commerce.ondemand.com/medias/sample-1280-xl.mp4?context=bWFzdGVyfHZpZGVvc3w5ODQwNDk3fHZpZGVvL21wNHxhRGM1TDJobE9TODRPRGs0TWpRNE56TTJOems0TDNOaGJYQnNaVjh4TWpnd1gzaHNMbTF3TkF8MWZhZDY2MjE3MGJhZGU1ZWJkZjU3NzE1Yjc5ZDVlYzJmZjYxNDhhM2ExNTg3MzFhNTZkNGE5MjdiYjdhMjAwMw" autoplay style="margin: 0 auto; width: 100%;
height: 100vh; object-fit: cover;"></video>

  <source src="https://www.w3schools.com/howto/rain.mp4" type="video/mp4">
  Your browser does not support HTML5 video.
</video>
    </div>
    <div id="prod-container">
    <p>Prod container</p>
    </div>


<script>
    const frameElement = document.getElementById('frame');
    const startButton = document.getElementById('start-button');
    const totalFrames = 249;
    const initialAnimationFrames = 28;
    const documentHeight = 10000; // Height for the whole scrollable document
    let currentFrame = 0;
    let scrollAnimationEnabled = false;
    const frameRate = 1000 / 30; // 30 FPS
    const scrollAnimationDuration = 6000; // Scroll animation duration in milliseconds

    const videoContainer = document.getElementById('video-container');
    const videoContainerTriggerPosition = 5000; // Position at which the transition should start
    const viewportHeight = window.innerHeight;

    window.addEventListener('scroll', function() {
            const viewportMiddle = window.pageYOffset + viewportHeight / 2;

            if (viewportMiddle >= videoContainerTriggerPosition) {
                videoContainer.style.width = '100vw';
                videoContainer.style.height = '100vh';
                videoContainer.style.borderRadius = '0px';
                videoContainer.style.opacity = 1;
            } else {
                videoContainer.style.width = '10vw';
                videoContainer.style.height = '10vh';
                videoContainer.style.borderRadius = '100px';
                videoContainer.style.opacity = 0;
            }
        });


    
    

    function updateFrame(frameIndex) {
        frameElement.src = `/Users/dz382/Documents/GitHub/Versuni/btl-tryouts/homepage-assets/home-entrance-desktop${frameIndex.toString().padStart(3, '0')}.jpg`;
    }

    // Initial animation from frame 1 to 28
    const initialAnimationInterval = setInterval(() => {
        if (currentFrame < initialAnimationFrames) {
            updateFrame(currentFrame);
            currentFrame++;
        } else {
            clearInterval(initialAnimationInterval);
            // Set the current frame to 28 after the initial animation
            currentFrame = initialAnimationFrames - 1;
            scrollAnimationEnabled = true;
            startButton.style.display = 'block'; // Show the button
        }
    }, frameRate);

    window.addEventListener('scroll', () => {
        if (!scrollAnimationEnabled) return;

        const scrollFraction = (window.pageYOffset + (documentHeight / totalFrames * initialAnimationFrames)) / (documentHeight - window.innerHeight);
        const frameIndex = Math.min(
            Math.floor(scrollFraction * totalFrames),
            totalFrames - 1
        );
        updateFrame(frameIndex);
    });

    startButton.addEventListener('click', function() {
        document.body.style.height = `${documentHeight}px`;

        // Start smooth scrolling from the current position
        const endScrollPosition = (documentHeight / totalFrames) * (totalFrames - 1);
        smoothScrollTo(endScrollPosition, scrollAnimationDuration);
    });

    // Custom smooth scroll function
    function smoothScrollTo(targetPosition, duration) {
        const startPosition = window.pageYOffset;
        const distance = targetPosition - startPosition;
        let startTime = null;

        function animation(currentTime) {
            if (startTime === null) startTime = currentTime;
            const timeElapsed = currentTime - startTime;
            const run = ease(timeElapsed, startPosition, distance, duration);
            window.scrollTo(0, run);

            const adjustedRun = run + (documentHeight / totalFrames * initialAnimationFrames);
            const newFrameIndex = Math.min(
                Math.floor((adjustedRun / (documentHeight - window.innerHeight)) * totalFrames),
                totalFrames - 1
            );
            updateFrame(newFrameIndex);

            if (timeElapsed < duration) requestAnimationFrame(animation);
        }

        function ease(t, b, c, d) {
            t /= d / 2;
            if (t < 1) return c / 2 * t * t + b;
            t--;
            return -c / 2 * (t * (t - 2) - 1) + b;
        }

        requestAnimationFrame(animation);
    }

    window.addEventListener('scroll', () => {
    if (!scrollAnimationEnabled) return;

    // Show or hide the start button based on scroll position
    if (window.pageYOffset === 0) {
        startButton.style.display = 'block';
    } else {
        startButton.style.display = 'none';
    }

    const scrollFraction = (window.pageYOffset + (documentHeight / totalFrames * initialAnimationFrames)) / (documentHeight - window.innerHeight);
    const frameIndex = Math.min(
        Math.floor(scrollFraction * totalFrames),
        totalFrames - 1
    );
    updateFrame(frameIndex);
});
</script>




</body>

</html>